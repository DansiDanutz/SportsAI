name: Test Vercel Token

on:
  workflow_dispatch: # Manual trigger only
  push:
    branches:
      - main

jobs:
  test-token:
    runs-on: ubuntu-latest
    steps:
      - name: Check if VERCEL_TOKEN is set
        run: |
          if [ -z "${{ secrets.VERCEL_TOKEN }}" ]; then
            echo "❌ VERCEL_TOKEN secret is NOT set in GitHub"
            echo "Please add it at: https://github.com/DansiDanutz/SportsAI/settings/secrets/actions"
            exit 1
          else
            echo "✅ VERCEL_TOKEN secret is set"
            echo "Token length: ${#VERCEL_TOKEN}"
          fi
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}

      - name: Verify Vercel CLI can authenticate
        run: |
          npm install --global vercel@latest
          if vercel whoami --token="${{ secrets.VERCEL_TOKEN }}" 2>&1 | grep -q "error\|Error\|unauthorized"; then
            echo "❌ VERCEL_TOKEN is invalid or expired"
            echo "Get a new token from: https://vercel.com/account/tokens"
            exit 1
          else
            echo "✅ VERCEL_TOKEN is valid"
            vercel whoami --token="${{ secrets.VERCEL_TOKEN }}"
          fi
